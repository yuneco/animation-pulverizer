(function () {
  'use strict';

  const A=(t,e)=>{const n=[],r=[];let i=document.elementFromPoint(t,e);for(;i&&!(i.tagName.toLowerCase()==="html"||!(i instanceof HTMLElement||i instanceof SVGElement));)r.push(i),n.push({el:i,pointerEvents:i.style.pointerEvents}),i.style.pointerEvents="none",i=document.elementFromPoint(t,e);return n.forEach(o=>o.el.style.pointerEvents=o.pointerEvents),r},m="animation-pulverizer_animatedClickTarget",v="animation-pulverizer_animatedClickHit",f="animation-pulverizer_ignored",T="animation-pulverizer_scoreLabel",E="animation-pulverizer_noiseFilter",C=t=>{const e=10,n=t.getBoundingClientRect(),r=n.width*n.height/(window.innerWidth*window.innerHeight);return Math.max(1,Math.round(1/r*e))},_=(t,e)=>{const n=document.createElement("div");n.textContent=`+${e}pt`,n.classList.add(f,T);const r=t.getBoundingClientRect();n.style.left=`${r.x}px`,n.style.top=`${r.y-80}px`,n.style.width=`${r.width}px`,document.body.appendChild(n),setTimeout(()=>{document.body.removeChild(n);},2e3);},M=(t,e=100)=>{t.animate([{opacity:t.style.opacity,transform:"scale(0.8)",filter:`blur(0) url('#${E}')`},{opacity:0,transform:"scale(1.5)",filter:`blur(10px) url('#${E}')`}],{fill:"forwards",duration:500}),_(t,e);},a=t=>t instanceof HTMLElement||t instanceof SVGElement,h=t=>t.classList.contains(v)?"hit":t.classList.contains(m)?"target":"wait",u=(t,e)=>{const n=h(t);if(n!==e){if(e==="hit"){if(n!=="target")return;x(t);}if(e==="target"){if(n!=="wait")return;I(t);}if(e==="wait"){if(n!=="target")return;N(t);}}},x=t=>{t.classList.remove(m),t.classList.add(v),M(t,C(t));},I=t=>{t.classList.add(m),t.removeEventListener("click",d),t.addEventListener("click",d);},N=t=>{t.classList.remove(m),t.removeEventListener("click",d);},d=t=>{console.log("direct",t),!!a(t.target)&&(u(t.target,"hit"),t.preventDefault(),t.stopImmediatePropagation(),t.target.removeEventListener("click",d));},k=["width","height","left","top","right","bottom","transform"],L=t=>!!(!a(t.target)||t.target.classList.contains(f)||t instanceof TransitionEvent&&!k.includes(t.propertyName)),c=[],b=t=>{if(!!a(t.target))return {element:{el:t.target,pseudo:t.pseudoElement},prop:t instanceof TransitionEvent?t.propertyName:t.animationName,type:t instanceof TransitionEvent?"transition":"animation"}},R=(t,e)=>t.element.el===e.element.el&&t.element.pseudo===e.element.pseudo&&t.prop===e.prop&&t.type===e.type,O=t=>{const e=r=>{if(!a(r.target)||L(r)||h(r.target)!=="wait")return;const i=b(r);!i||(c.push(i),t([i.element],[],c.map(o=>o.element)));},n=r=>{if(r instanceof TransitionEvent&&L(r))return;const i=b(r);if(!i)return;const o=c.findIndex(p=>R(p,i));if(o===-1)return;const l=c.splice(o,1)[0];!l||t([],[l.element],c.map(p=>p.element));};document.body.addEventListener("transitionstart",e),document.body.addEventListener("transitionend",n),document.body.addEventListener("animationstart",e),document.body.addEventListener("animationend",n);},P=(t,e)=>({added:e.filter(n=>!t.includes(n)),removed:t.filter(n=>!e.includes(n))}),S=["width","height","left","top","right","bottom","transform"];let s=[];const F=100,$=t=>{const e=S.map(n=>{var r;return [n,(r=t.style[n])==null?void 0:r.toString()]}).filter(n=>n[1]);if(!!e.length)return Object.fromEntries(e)},H=(t,e)=>S.some(n=>t[n]!==e[n]),D=(t,e)=>{const n=$(t);if(!!n&&!(e&&!H(n,e.props)))return {el:t,isActive:!!e,expired:Date.now()+F,props:n}},G=t=>s.find(e=>e.el===t),z=t=>{const e=s.findIndex(n=>n.el===t);if(e!==-1)return s.splice(e,1)[0]},B=t=>{if(t.classList.contains(f))return;const e=G(t),n=D(t,e);!n||(z(t),h(t)!=="hit"&&n&&s.push(n));},V=()=>{const t=Date.now();s=s.filter(e=>e.expired>t);},q=()=>{new MutationObserver(function(e){e.map(r=>r.target).filter(a).forEach(B);}).observe(document.body,{subtree:!0,attributes:!0,attributeFilter:["style"]});},W=()=>s.filter(t=>t.isActive).map(t=>t.el),j=t=>{let e=[];q();const n=()=>{V();const r=W(),{added:i,removed:o}=P(e,r);if(i.length||o.length){try{t(i,o,r);}catch(l){console.warn(l);}e=[...r];}requestAnimationFrame(n);};n();};let g=[],y=[];const U=t=>{O((e,n,r)=>{g=[...r],t(e,n,[...g,...y]);}),j((e,n,r)=>{y=[...r.map(i=>({el:i,pseudo:""}))],t(e.map(i=>({el:i,pseudo:""})),n.map(i=>({el:i,pseudo:""})),[...g,...y]);});};const X=t=>`
<filter id='${t}' x='0%' y='0%' width='110%' height='110%'>
  <feTurbulence type="turbulence" baseFrequency="0.2 0.2" result="NOISE" numOctaves="2" />
  <feDisplacementMap in="SourceGraphic" in2="NOISE" scale="16" xChannelSelector="R" yChannelSelector="R"></feDisplacementMap>
</filter>
`,Y=()=>{const t="http://www.w3.org/2000/svg",e=document.createElementNS(t,"svg");e.innerHTML=X(E),document.body.appendChild(e);};let w=!1;const J=()=>{if(w)return;w=!0,console.log("\u{1F52B}GAME START!"),Y();let t=[];U((e,n,r)=>{t=[...r],e.map(i=>{u(i.el,"target");}),n.map(i=>{u(i.el,"wait");});}),document.body.addEventListener("pointerdown",e=>{const n=A(e.clientX,e.clientY),r=t.map(o=>o.el),i=n.filter(o=>r.includes(o));i.forEach(o=>u(o,"hit")),i.length&&(e.preventDefault(),e.cancelBubble=!0);});};chrome.runtime.onMessage.addListener(t=>{t.action==="activate"&&J();});

})();
